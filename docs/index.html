<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>SmartOS Pro</title>
    <style>
        :root {
            --wechat-green: #07C160;
            --ios-blue: #007AFF;
            --glass: rgba(255, 255, 255, 0.7);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, sans-serif; }
        body { background: #000; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        .app-container {
            width: 100%; height: 100%; background: #fff; position: relative;
            overflow: hidden; display: flex; flex-direction: column;
        }
        @media (min-width: 600px) {
            .app-container { max-width: 375px; height: 812px; border-radius: 40px; border: 8px solid #333; }
        }

        /* çŠ¶æ€æ  & å¯¼èˆª */
        .status-bar { height: 44px; padding: 14px 20px 0; display: flex; justify-content: space-between; align-items: center; font-size: 14px; font-weight: 600; z-index: 100; }
        .nav-bar { height: 50px; background: rgba(255,255,255,0.8); backdrop-filter: blur(10px); border-bottom: 0.5px solid #ddd; display: flex; align-items: center; justify-content: space-between; padding: 0 15px; flex-shrink: 0; }
        
        /* é¡µé¢å¼•æ“ */
        .page { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #F2F2F7; display: none; flex-direction: column; z-index: 10; padding-top: 44px; }
        .page.active { display: flex; }

        /* æ¡Œé¢æ ·å¼ */
        .home-bg { transition: background 1s ease; }
        .home-clock { text-align: center; padding: 30px 0; }
        .home-clock h1 { font-size: 64px; font-weight: 200; letter-spacing: -2px; }
        
        .app-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; padding: 20px 25px; }
        .app-item { display: flex; flex-direction: column; align-items: center; cursor: pointer; }
        .app-icon { width: 60px; height: 60px; background: var(--glass); border-radius: 18px; display: flex; align-items: center; justify-content: center; font-size: 28px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 10px 20px rgba(0,0,0,0.06); }
        .app-name { font-size: 11px; margin-top: 8px; font-weight: 500; }

        /* èŠå¤©æ°”æ³¡ä¼˜åŒ– */
        #chat-flow { flex: 1; overflow-y: auto; background: #ededed; padding: 15px; display: flex; flex-direction: column; gap: 12px; }
        .msg-row { display: flex; gap: 10px; max-width: 85%; }
        .msg-row.mine { align-self: flex-end; flex-direction: row-reverse; }
        .avatar { width: 35px; height: 35px; border-radius: 6px; background: #fff; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
        .bubble { padding: 10px 14px; border-radius: 10px; font-size: 15px; line-height: 1.4; position: relative; }
        .mine .bubble { background: var(--wechat-green); color: #fff; }
        .other .bubble { background: #fff; color: #000; }

        /* åˆ—è¡¨ & å¼¹çª— */
        .list-item { padding: 15px; border-bottom: 0.5px solid #eee; background: #fff; display: flex; align-items: center; gap: 10px; }
        .modal { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: 1000; display: none; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-body { width: 85%; background: #fff; border-radius: 24px; padding: 25px; }
        .modal-body input { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; outline: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="status-bar" id="status-bar">
        <span id="st-time">00:00</span>
        <div>ğŸ“¶ ğŸ”‹</div>
    </div>

    <div class="page active home-bg" id="p-home">
        <div class="home-clock">
            <h1 id="big-clock">00:00</h1>
            <p id="big-date" style="opacity:0.6"></p>
        </div>
        <div class="app-grid">
            <div class="app-item" onclick="to('p-chat')"><div class="app-icon">ğŸ’¬</div><div class="app-name">å¾®ä¿¡</div></div>
            <div class="app-item" onclick="to('p-album')"><div class="app-icon">ğŸ–¼ï¸</div><div class="app-name">ç›¸å†Œ</div></div>
            <div class="app-item" onclick="to('p-cal')"><div class="app-icon">ğŸ“…</div><div class="app-name">æ—¥å†</div></div>
            <div class="app-item" onclick="to('p-con')"><div class="app-icon">ğŸ‘¥</div><div class="app-name">é€šè®¯å½•</div></div>
            <div class="app-item" onclick="to('p-safari')"><div class="app-icon">ğŸŒ</div><div class="app-name">Safari</div></div>
        </div>
    </div>

    <div class="page" id="p-chat">
        <div class="nav-bar"><span onclick="to('p-home')" style="color:var(--ios-blue)">ã€ˆ æ¡Œé¢</span><b id="chat-title">æœ¨æœ¨</b><span onclick="openMod('m-api')" style="font-size:12px;color:var(--ios-blue)">APIè®¾ç½®</span></div>
        <div id="chat-flow"></div>
        <div style="padding:10px; background:#f7f7f7; display:flex; gap:10px;">
            <input type="text" id="chat-in" style="flex:1; padding:10px; border-radius:8px; border:1px solid #ddd;">
            <button onclick="sendMsg()" style="background:var(--wechat-green); color:#fff; border:none; padding:0 15px; border-radius:8px;">å‘é€</button>
        </div>
    </div>

    <div class="page" id="p-album">
        <div class="nav-bar"><span onclick="to('p-home')" style="color:var(--ios-blue)">ã€ˆ è¿”å›</span><b>ç›¸å†Œ</b><span onclick="document.getElementById('up').click()" style="color:var(--ios-blue)">ä¸Šä¼ </span></div>
        <input type="file" id="up" hidden onchange="upImg(this)">
        <div style="flex:1; overflow-y:auto;" id="album-box" style="display:grid; grid-template-columns:repeat(3,1fr); gap:2px;"></div>
    </div>

    <div class="page" id="p-cal">
        <div class="nav-bar"><span onclick="to('p-home')" style="color:var(--ios-blue)">ã€ˆ è¿”å›</span><b>çºªå¿µæ—¥</b><span onclick="openMod('m-anni')" style="color:var(--ios-blue)">æ·»åŠ </span></div>
        <div id="anni-list" style="flex:1; overflow-y:auto;"></div>
    </div>

    <div class="page" id="p-con">
        <div class="nav-bar"><span onclick="to('p-home')" style="color:var(--ios-blue)">ã€ˆ è¿”å›</span><b>é€šè®¯å½•</b><span onclick="openMod('m-con')" style="color:var(--ios-blue)">â•</span></div>
        <div id="con-list" style="flex:1; overflow-y:auto;"></div>
    </div>

    <div class="page" id="p-safari">
        <div class="nav-bar"><span onclick="to('p-home')" style="color:var(--ios-blue)">ã€ˆ é€€å‡º</span><b>æµè§ˆå™¨</b></div>
        <iframe src="https://m.bing.com" style="flex:1; border:none;"></iframe>
    </div>

    <div class="modal" id="m-api"><div class="modal-body"><h3>AI è®¾ç½®</h3><input type="checkbox" id="api-toggle"> å¼€å¯è”ç½‘<input type="text" id="api-url" placeholder="API URL"><input type="password" id="api-key" placeholder="API Key"><button onclick="saveApi()" style="width:100%; padding:12px; background:var(--ios-blue); color:#fff; border:none; border-radius:10px; margin-top:10px;">ä¿å­˜</button><button onclick="closeMod('m-api')" style="width:100%; margin-top:10px; border:none; background:none;">å–æ¶ˆ</button></div></div>
    
    <div class="modal" id="m-anni"><div class="modal-body"><h3>æ–°çºªå¿µæ—¥</h3><input type="text" id="at" placeholder="åç§°"><input type="date" id="ad"><button onclick="saveAnni()" style="width:100%; padding:12px; background:var(--ios-blue); color:#fff; border:none; border-radius:10px;">ä¿å­˜</button></div></div>

    <div class="modal" id="m-con"><div class="modal-body"><h3>æ–°è”ç³»äºº</h3><input type="text" id="cn" placeholder="å§“å"><button onclick="saveCon()" style="width:100%; padding:12px; background:var(--ios-blue); color:#fff; border:none; border-radius:10px;">ä¿å­˜</button></div></div>
</div>

<script>
    // åŸºç¡€è·¯ç”±
    function to(id) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
    function openMod(id) { document.getElementById(id).style.display = 'flex'; }
    function closeMod(id) { document.getElementById(id).style.display = 'none'; }

    // æ—¶é—´ä¸èƒŒæ™¯æ„ŸçŸ¥
    function updateClock() {
        const now = new Date();
        const h = String(now.getHours()).padStart(2, '0');
        const m = String(now.getMinutes()).padStart(2, '0');
        const timeStr = `${h}:${m}`;
        document.getElementById('st-time').innerText = timeStr;
        document.getElementById('big-clock').innerText = timeStr;
        document.getElementById('big-date').innerText = now.toLocaleDateString('zh-CN', {month:'long', day:'numeric', weekday:'short'});

        const hour = now.getHours();
        const home = document.getElementById('p-home');
        if (hour >= 18 || hour < 6) {
            home.style.background = "linear-gradient(180deg, #1A237E 0%, #000 100%)";
            home.style.color = "#fff";
            document.getElementById('status-bar').style.color = "#fff";
        } else {
            home.style.background = "linear-gradient(180deg, #e3f2fd 0%, #fce4ec 100%)";
            home.style.color = "#000";
            document.getElementById('status-bar').style.color = "#000";
        }
    }
    setInterval(updateClock, 1000); updateClock();

    // æ•°æ®æŒä¹…åŒ–é€»è¾‘
    let photos = JSON.parse(localStorage.getItem('m_photos') || '[]');
    let annis = JSON.parse(localStorage.getItem('m_annis') || '[]');
    let cons = JSON.parse(localStorage.getItem('m_cons') || '[{"name":"æœ¨æœ¨"}]');

    function renderAll() {
        // æ¸²æŸ“ç›¸å†Œ
        const box = document.getElementById('album-box'); box.innerHTML = '';
        box.style.display = 'grid'; box.style.gridTemplateColumns = 'repeat(3,1fr)'; box.style.gap='2px';
        photos.forEach(src => box.innerHTML += `<div style="aspect-ratio:1/1; background:url(${src}) center/cover"></div>`);
        
        // æ¸²æŸ“çºªå¿µæ—¥
        const aList = document.getElementById('anni-list'); aList.innerHTML = '';
        annis.forEach(a => aList.innerHTML += `<div class="list-item">ğŸ“… <b>${a.d}</b> ${a.t}</div>`);

        // æ¸²æŸ“è”ç³»äºº
        const cList = document.getElementById('con-list'); cList.innerHTML = '';
        cons.forEach(c => cList.innerHTML += `<div class="list-item" onclick="to('p-chat')">ğŸ‘¤ ${c.name}</div>`);
    }

    function upImg(el) {
        const fr = new FileReader();
        fr.onload = (e) => { photos.unshift(e.target.result); localStorage.setItem('m_photos', JSON.stringify(photos)); renderAll(); };
        fr.readAsDataURL(el.files[0]);
    }

    function saveAnni() {
        annis.push({t: document.getElementById('at').value, d: document.getElementById('ad').value});
        localStorage.setItem('m_annis', JSON.stringify(annis)); renderAll(); closeMod('m-anni');
    }

    function saveCon() {
        cons.push({name: document.getElementById('cn').value});
        localStorage.setItem('m_cons', JSON.stringify(cons)); renderAll(); closeMod('m-con');
    }

    // èŠå¤©åŠŸèƒ½
    let apiCfg = JSON.parse(localStorage.getItem('mumu_api_v2') || '{"enabled":false,"url":"","key":""}');
    function saveApi() {
        apiCfg = { enabled: document.getElementById('api-toggle').checked, url: document.getElementById('api-url').value, key: document.getElementById('api-key').value };
        localStorage.setItem('mumu_api_v2', JSON.stringify(apiCfg));
        closeMod('m-api');
    }

    async function sendMsg() {
        const input = document.getElementById('chat-in');
        const val = input.value.trim(); if(!val) return;
        append('mine', val); input.value = '';
        
        if (!apiCfg.enabled) {
            setTimeout(() => append('other', "æœ¬åœ°æ¨¡å¼ï¼šæ”¶åˆ°å•¦ã€‚"), 600);
            return;
        }
        try {
            const res = await fetch(apiCfg.url, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${apiCfg.key}` },
                body: JSON.stringify({ model: 'deepseek-ai/DeepSeek-V3', messages: [{role: "system", content: "ä½ å«æœ¨æœ¨ï¼Œæ¸©æŸ”ç®€ç»ƒã€‚"}, {role: "user", content: val}] })
            });
            const data = await res.json();
            append('other', data.choices[0].message.content);
        } catch(e) { append('other', "è¿æ¥è¶…æ—¶ã€‚"); }
    }

    function append(side, text) {
        const flow = document.getElementById('chat-flow');
        const avatar = side === 'mine' ? 'ğŸ‘¤' : 'ğŸªµ';
        flow.insertAdjacentHTML('beforeend', `
            <div class="msg-row ${side}">
                <div class="avatar">${avatar}</div>
                <div class="bubble">${text}</div>
            </div>
        `);
        flow.scrollTop = flow.scrollHeight;
    }

    renderAll();
</script>
</body>
</html>

